{% extends "base.html" %}
{% load i18n static avatar %}
{% block title %}{% trans 'Actualiser ' %}{{car.name}}{% endblock title %}
{% block content %}
{% include 'includes/header.html' %}
<div class="container form-container-small d-flex ">
    <div class="abstract-form v-abstract-form mx-auto my-auto ">
        
        
        <h3 class="text-center">{% trans 'Actualiser votre profil' %}</h3>
        <div class="row justify-content-center">
            <div class="form-content">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="col-12 text-center">
                        <div class="avatar-input">
                            <input type="file" id="fileElem" multiple accept="image/*" name="avatar" style="display:none"  />
                       
                            {% if request.user.avatar %}
                                <a href="#" id="fileSelect" class="icon">
                                <img class="rounded-circle avatar-upload" src="{{ user.avatar.url }} " style="cursor: pointer;"/>
                                </a>
                            {% else %}
                                <a href="#" id="fileSelect" class="icon">{{ request.user|avatar }}</a>
                            {% endif %}
                        </div>
                        <div class="change-image"><span class="icon" data-icon="&#43;"></span></div>
<div id="fileList" class="mt-3 color-light">
  <p></p>
</div>
</div>
                        <div class="form-group">
                            <label>{% trans 'Pseudo' %}:</label>
                            {{ form.username}}
                            <span class="light-color">{{form.username.errors}}</span>
                        </div>
                        <div class="form-group">
                            <label>{% trans 'Courriel' %}:</label>
                            {{ form.email}}
                            <span class="light-color">{{form.email.errors}}</span>
                        </div>
                        

                        
                        <div class="row justify-content-center">
                            <button type="submit" class="btn btn-kdark rounded-btn" name="update_car">{% trans 'Enregistrer' %}</button>
                            <a href="{% url 'profile' user.id %}" class="btn btn-kbrand rounded-btn" >{% trans 'Annuler' %}</a>
                        </div>
                </form>
            </div>
         </div>
    </div>
</div>

   

{% endblock content %}

{% block extrajs %}
<script>
const fileSelect = document.getElementById("fileSelect"),
  fileElem = document.getElementById("fileElem"),
  fileList = document.getElementById("fileList");

fileSelect.addEventListener(
  "click",
  (e) => {
    if (fileElem) {
      fileElem.click();
    }
    e.preventDefault(); // prevent navigation to "#"
  },
  false
);

fileElem.addEventListener("change", handleFiles, false);

function handleFiles() {
  if (!this.files.length) {
    fileList.innerHTML = "<p>No files selected!'</p>";
  } else {
    fileList.innerHTML = "";
    const list = document.createElement("ul");
    fileList.appendChild(list);
    for (let i = 0; i < this.files.length; i++) {
      const li = document.createElement("li");
      list.appendChild(li);

      const img = document.createElement("img");
      img.src = URL.createObjectURL(this.files[i]);
      img.height = 60;
      img.className = "rounded-circle avatar-upload";
      img.onload = () => {
        URL.revokeObjectURL(img.src);
      };
      
      li.appendChild(img);
      
      const info = document.createElement("span");
      info.innerHTML = `${this.files[i].name}: ${this.files[i].size} bytes`;
      li.appendChild(info);
    }
  }
}
</script>
{% endblock extrajs%}